<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Duppy (duppy.Duppy)</title><link rel="stylesheet" href="../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">duppy</a> &#x00BB; Duppy</nav><header class="odoc-preamble"><h1>Module <code><span>Duppy</span></code></h1><p>Advanced scheduler and monad for server-oriented programming.</p></header><nav class="odoc-toc"><ul><li><a href="#duppy-task-scheduler-for-ocaml.">Duppy task scheduler for OCaml.</a></li><li><a href="#some-culture..">Some culture..</a></li></ul></nav><div class="odoc-content"><p>* </p><p><i></i></p><pre>    *        The bars could not hold me;
    *        Force could not control me now.
    *        They try to keep me down, yeah!
    *        But Jah put I around.
    *        (...)
    *        Let me tell you this -
    *        I'm a duppy conqueror !
    *       </pre><p>}</p><p>}</p><p>* </p><p><b>Lee &quot;Scratch&quot; Perry &amp; Bob Marley - Duppy conqueror</b></p><p>* * </p><h3 id="duppy-task-scheduler-for-ocaml."><a href="#duppy-task-scheduler-for-ocaml." class="anchor"></a>Duppy task scheduler for OCaml.</h3><p>* * <a href="#"><code>Duppy</code></a> is a task scheduler for ocaml. It implements a wrapper * around <code>Unix.select</code>. * * Using <a href="Task/index.html"><code>Duppy.Task</code></a>, the programmer can easily submit tasks that need to wait * on a socket even, or for a given timeout (possibly zero). * * With <a href="Async/index.html"><code>Duppy.Async</code></a>, one can use a scheduler to submit asynchronous tasks. * * <a href="Io/index.html"><code>Duppy.Io</code></a> implements recursive easy reading and writing to a <code>Unix.file_descr</code> * * Finally, <a href="Monad/index.html"><code>Duppy.Monad</code></a> and <a href="Monad/Io/index.html"><code>Duppy.Monad.Io</code></a> provide a monadic interface to * program server code that with an implicit return/reply execution flow. * * The scheduler can use several queues running concurently, each queue * processing ready tasks. Of course, a queue should run in its own thread.</p><div class="odoc-spec"><div class="spec type anchored" id="type-scheduler"><a href="#type-scheduler" class="anchor"></a><code><span><span class="keyword">type</span> <span>'a scheduler</span></span></code></div><div class="spec-doc"><p>A scheduler is a device for processing tasks. Several queues might run in * different threads, processing one scheduler's tasks. * * <code>'a</code> is the type of objects used for priorities.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-create"><a href="#val-create" class="anchor"></a><code><span><span class="keyword">val</span> create : 
  <span>?on_error:<span>(<span>exn <span class="arrow">&#45;&gt;</span></span> <span><span class="xref-unresolved">Stdlib</span>.Printexc.raw_backtrace <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?compare:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> int)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span><span class="type-var">'a</span> <a href="#type-scheduler">scheduler</a></span></span></code></div><div class="spec-doc"><p>Initiate a new scheduler * </p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">compare</span> <p>the comparison function used to sort tasks according to priorities. * Works as in <code>List.sort</code></p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-poll"><a href="#val-poll" class="anchor"></a><code><span><span class="keyword">val</span> poll : 
  <span><span><span class="xref-unresolved">Unix</span>.file_descr list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Unix</span>.file_descr list</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="xref-unresolved">Unix</span>.file_descr list</span> <span class="arrow">&#45;&gt;</span></span>
  <span>float <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Unix</span>.file_descr list</span> * <span><span class="xref-unresolved">Unix</span>.file_descr list</span> * <span><span class="xref-unresolved">Unix</span>.file_descr list</span></span></code></div><div class="spec-doc"><p>Internal polling function. Uses `Unix.select` on windows and `poll` otherwise.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-queue"><a href="#val-queue" class="anchor"></a><code><span><span class="keyword">val</span> queue : 
  <span>?log:<span>(<span>string <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span>
  <span>?priorities:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> bool)</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="#type-scheduler">scheduler</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>string <span class="arrow">&#45;&gt;</span></span>
  unit</span></code></div><div class="spec-doc"><p><code>queue ~log ~priorities s name</code> * starts a queue, on the scheduler <code>s</code> only processing priorities <code>p</code> * for which <code>priorities p</code> returns <code>true</code>. * * Several queues can be run concurrently against <code>s</code>. * </p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">log</span> <p>Logging function. Default: <code>Printf.printf &quot;queue %s: %s\n&quot; name</code> * </p><p>@param priorities</p><p>Predicate specifying which priority to process. Default: <code>fun _ -&gt; _ -&gt; true</code> * * An exception is raised from this call when duppy's event loops has * crashed. This exception should be considered a MAJOR FAILURE. All current * non-ready tasks registered for the calling scheduler are dropped. You may * restart Duppy's queues after it is raised but it should only be used to terminate * the process diligently!!</p></li></ul></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-stop"><a href="#val-stop" class="anchor"></a><code><span><span class="keyword">val</span> stop : <span><span><span class="type-var">'a</span> <a href="#type-scheduler">scheduler</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p>Stop all queues running on that scheduler and wait for them to return.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Task"><a href="#module-Task" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Task/index.html">Task</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Core task registration. * * A task will be a set of events to watch, and a corresponding function to * execute when one of the events is trigered. * * The executed function may then return a list of new tasks to schedule.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Async"><a href="#module-Async" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Async/index.html">Async</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Asynchronous task module * * This module implements an asychronous API to <a href="#type-scheduler"><code>Duppy.scheduler</code></a> * It allows to create a task that will run and then go to sleep.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-Transport_t"><a href="#module-type-Transport_t" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Transport_t/index.html">Transport_t</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Module type for Io functor.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-Io_t"><a href="#module-type-Io_t" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Io_t/index.html">Io_t</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Easy parsing of <code>Unix.file_descr</code>. * * With <a href="Io/index.html#val-read"><code>Duppy.Io.read</code></a>, you can pass a file descriptor to the scheduler, * along with a marker, and have it run the associated function when the * marker is found. * * With <a href="Io/index.html#val-write"><code>Duppy.Io.write</code></a>, the schdeduler will try to write recursively to the file descriptor * the given string.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-MakeIo"><a href="#module-MakeIo" class="anchor"></a><code><span><span class="keyword">module</span> <a href="MakeIo/index.html">MakeIo</a></span><span> (<a href="MakeIo/argument-1-Transport/index.html">Transport</a> : <a href="module-type-Transport_t/index.html">Transport_t</a>) : <a href="module-type-Io_t/index.html">Io_t</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-Io_t/index.html#type-socket">socket</a> = <a href="MakeIo/argument-1-Transport/index.html#type-t">Transport.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Io"><a href="#module-Io" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Io/index.html">Io</a></span><span> : <a href="module-type-Io_t/index.html">Io_t</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-Io_t/index.html#type-socket">socket</a> = <span class="xref-unresolved">Unix</span>.file_descr</span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Monad"><a href="#module-Monad" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Monad/index.html">Monad</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Monadic interface to <a href="Io/index.html"><code>Duppy.Io</code></a>. * * This module can be used to write code * that runs in various Duppy's tasks and * raise values in a completely transparent way. * * You can see examples of its use * in the <code>examples/</code> directory of the * source code and in the files * <code>src/tools/{harbor.camlp4,server.camlp4}</code> * in liquidsoap's code. * * When a server communicates * with a client, it performs several * computations and, eventually, terminates. * A computation can either return a new * value or terminate. For instance: * * - Client connects. * - Server tries to authenticate the client. * - If authentication is ok, proceed with the next step. * - Otherwise terminate. * * The purpose of the monad is to embed * computations which can either return * a new value or raise a value that is used * to terminate.</p></div></div><h3 id="some-culture.."><a href="#some-culture.." class="anchor"></a>Some culture..</h3><p>* <em>Duppy is a Caribbean patois word of West African origin meaning ghost or spirit. * Much of Caribbean folklore revolves around duppies. * Duppies are generally regarded as malevolent spirits. * They are said to come out and haunt people at night mostly, * and people from the islands claim to have seen them. * The 'Rolling Calf', 'Three footed horse' or 'Old Higue' are examples of the more malicious spirits.</em> * </p><p><a href="http://en.wikipedia.org/wiki/Duppy">http://en.wikipedia.org/wiki/Duppy</a></p></div></body></html>