<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Monad (duppy.Duppy.Monad)</title><link rel="stylesheet" href="../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">duppy</a> &#x00BB; <a href="../index.html">Duppy</a> &#x00BB; Monad</nav><header class="odoc-preamble"><h1>Module <code><span>Duppy.Monad</span></code></h1><p>Monadic interface to <a href="../Io/index.html"><code>Duppy.Io</code></a>. * * This module can be used to write code * that runs in various Duppy's tasks and * raise values in a completely transparent way. * * You can see examples of its use * in the <code>examples/</code> directory of the * source code and in the files * <code>src/tools/{harbor.camlp4,server.camlp4}</code> * in liquidsoap's code. * * When a server communicates * with a client, it performs several * computations and, eventually, terminates. * A computation can either return a new * value or terminate. For instance: * * - Client connects. * - Server tries to authenticate the client. * - If authentication is ok, proceed with the next step. * - Otherwise terminate. * * The purpose of the monad is to embed * computations which can either return * a new value or raise a value that is used * to terminate.</p></header><div class="odoc-content"><div class="odoc-spec"><div class="spec type anchored" id="type-t"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b) t</span></span></code></div><div class="spec-doc"><p>Type representing a computation * which returns a value of type <code>'a</code> * or raises a value of type <code>'b</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-return"><a href="#val-return" class="anchor"></a><code><span><span class="keyword">val</span> return : <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>return x</code> create a computation that * returns value <code>x</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-raise"><a href="#val-raise" class="anchor"></a><code><span><span class="keyword">val</span> raise : <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>raise x</code> create a computation that raises * value <code>x</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-bind"><a href="#val-bind" class="anchor"></a><code><span><span class="keyword">val</span> bind : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p>Compose two computations. * <code>bind f g</code> is equivalent to: * <code>let x = f in g x</code> where <code>x</code> * has f's return type.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(&gt;&gt;=)"><a href="#val-(&gt;&gt;=)" class="anchor"></a><code><span><span class="keyword">val</span> (&gt;&gt;=) : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>&gt;&gt;=</code> is an alternative notation * for <code>bind</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-run"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span>return:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span>raise:<span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> unit)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>run f ~return ~raise ()</code> executes <code>f</code> and process * returned values with <code>return</code> or raised values * with <code>raise</code>.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-catch"><a href="#val-catch" class="anchor"></a><code><span><span class="keyword">val</span> catch : <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>catch f g</code> redirects values <code>x</code> raised during * <code>f</code>'s execution to <code>g</code>. The name suggests the * usual <code>try .. with ..</code> exception catching.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-(=&lt;&lt;)"><a href="#val-(=&lt;&lt;)" class="anchor"></a><code><span><span class="keyword">val</span> (=&lt;&lt;) : <span><span>(<span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>=&lt;&lt;</code> is an alternative notation for catch.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-fold_left"><a href="#val-fold_left" class="anchor"></a><code><span><span class="keyword">val</span> fold_left : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'b</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(<span class="type-var">'a</span>, <span class="type-var">'c</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>fold_left f a [b1; b2; ..]</code> returns computation * <code> (f a b1) &gt;&gt;= (fun a -&gt; f a b2) &gt;&gt;= ...</code></p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-iter"><a href="#val-iter" class="anchor"></a><code><span><span class="keyword">val</span> iter : <span><span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span>)</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> list</span> <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'b</span>)</span> <a href="#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>iter f [x1; x2; ..]</code> returns computation * <code>f x1 &gt;&gt;= (fun () -&gt; f x2) &gt;&gt;= ...</code></p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Mutex"><a href="#module-Mutex" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Mutex/index.html">Mutex</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>This module implements monadic * mutex computations. They can be used * to write blocking code that is compatible * with duppy's tasks, i.e. <code>Mutex.lock m</code> blocks * the calling computation and not the calling thread.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Condition"><a href="#module-Condition" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Condition/index.html">Condition</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>This module implements monadic * condition computations. They can be used * to write waiting code that is compatible * with duppy's tasks, i.e. <code>Condition.wait c m</code> blocks * the calling computation and not the calling thread * until <code>Condition.signal c</code> or <code>Condition.broadcast c</code> has * been called.</p></div></div><div class="odoc-spec"><div class="spec module-type anchored" id="module-type-Monad_io_t"><a href="#module-type-Monad_io_t" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Monad_io_t/index.html">Monad_io_t</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>This module implements monadic computations * using <code>Duppy.Io</code>. It can be used to create * computations that read or write from a socket, * and also to redirect a computation in a different * queue with a new priority.</p></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-MakeIo"><a href="#module-MakeIo" class="anchor"></a><code><span><span class="keyword">module</span> <a href="MakeIo/index.html">MakeIo</a></span><span>
  (<a href="MakeIo/argument-1-Io/index.html">Io</a> : <a href="../module-type-Io_t/index.html">Io_t</a>) : 
  <a href="module-type-Monad_io_t/index.html">Monad_io_t</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-Monad_io_t/index.html#type-socket">socket</a> = <a href="MakeIo/argument-1-Io/index.html#type-socket">Io.socket</a></span> <span class="keyword">and</span> <span><span class="keyword">module</span> <a href="module-type-Monad_io_t/Io/index.html">Io</a> = <a href="MakeIo/argument-1-Io/index.html">Io</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Io"><a href="#module-Io" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Io/index.html">Io</a></span><span> : <a href="module-type-Monad_io_t/index.html">Monad_io_t</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-Monad_io_t/index.html#type-socket">socket</a> = <span class="xref-unresolved">Unix</span>.file_descr</span> <span class="keyword">and</span> <span><span class="keyword">module</span> <a href="module-type-Monad_io_t/Io/index.html">Io</a> = <a href="../Io/index.html">Io</a></span></span></code></div></div></div></body></html>