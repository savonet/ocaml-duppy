<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>MakeIo (duppy.Duppy.Monad.MakeIo)</title><link rel="stylesheet" href="../../../../odoc.support/odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.2.1"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../../odoc.support/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../../index.html">duppy</a> &#x00BB; <a href="../../index.html">Duppy</a> &#x00BB; <a href="../index.html">Monad</a> &#x00BB; MakeIo</nav><header class="odoc-preamble"><h1>Module <code><span>Monad.MakeIo</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#parameters">Parameters</a></li><li><a href="#signature">Signature</a><ul><li><a href="#type">Type</a></li><li><a href="#execution-flow">Execution flow</a></li><li><a href="#read/write">Read/write</a></li></ul></li></ul></nav><div class="odoc-content"><h2 id="parameters"><a href="#parameters" class="anchor"></a>Parameters</h2><div class="odoc-spec"><div class="spec parameter anchored" id="argument-1-Io"><a href="#argument-1-Io" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="argument-1-Io/index.html">Io</a></span><span> : <a href="../../module-type-Io_t/index.html">Io_t</a></span></code></div></div><h2 id="signature"><a href="#signature" class="anchor"></a>Signature</h2><div class="odoc-spec"><div class="spec type anchored" id="type-socket"><a href="#type-socket" class="anchor"></a><code><span><span class="keyword">type</span> socket</span><span> = <a href="argument-1-Io/index.html#type-socket">Io.socket</a></span></code></div></div><div class="odoc-spec"><div class="spec module anchored" id="module-Io"><a href="#module-Io" class="anchor"></a><code><span><span class="keyword">module</span> Io</span><span> = <a href="argument-1-Io/index.html">Io</a></span></code></div></div><h3 id="type"><a href="#type" class="anchor"></a>Type</h3><div class="odoc-spec"><div class="spec type anchored" id="type-handler"><a href="#type-handler" class="anchor"></a><code><span><span class="keyword">type</span> <span>('a, 'b) handler</span></span><span> = </span><span>{</span></code><ol><li id="type-handler.scheduler" class="def record field anchored"><a href="#type-handler.scheduler" class="anchor"></a><code><span>scheduler : <span><span class="type-var">'a</span> <a href="../../index.html#type-scheduler">scheduler</a></span>;</span></code></li><li id="type-handler.socket" class="def record field anchored"><a href="#type-handler.socket" class="anchor"></a><code><span>socket : <a href="argument-1-Io/index.html#type-socket">Io.socket</a>;</span></code></li><li id="type-handler.data" class="def record field anchored"><a href="#type-handler.data" class="anchor"></a><code><span><span class="keyword">mutable</span> data : string;</span></code></li><li id="type-handler.on_error" class="def record field anchored"><a href="#type-handler.on_error" class="anchor"></a><code><span>on_error : <span><a href="argument-1-Io/index.html#type-failure">Io.failure</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>;</span></code></li></ol><code><span>}</span></code></div><div class="spec-doc"><p>A handler for this module * is a record that contains the * required elements. In particular, * <code>on_error</code> is a function that transforms * an error raised by <code>Duppy.Io</code> to a reply * used to terminate the computation. * <code>data</code> is an internal data buffer. It should * be initialized with <code>&quot;&quot;</code>. It contains the * remaining data that was received when * using <code>read</code>. If an error occured, * <code>data</code> contain data read before the * error.</p></div></div><h3 id="execution-flow"><a href="#execution-flow" class="anchor"></a>Execution flow</h3><div class="odoc-spec"><div class="spec value anchored" id="val-exec"><a href="#val-exec" class="anchor"></a><code><span><span class="keyword">val</span> exec : 
  <span>?delay:float <span class="arrow">&#45;&gt;</span></span>
  <span>priority:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-handler">handler</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="../index.html#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(<span class="type-var">'c</span>, <span class="type-var">'b</span>)</span> <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>exec ?delay ~priority h f</code> redirects computation * <code>f</code> into a new queue with priority <code>priority</code> and * delay <code>delay</code> (<code>0.</code> by default). * It can be used to redirect a computation that * has to run under a different priority. For instance, * a computation that reads from a socket is generally * not blocking because the function is executed * only when some data is available for reading. * However, if the data that is read needs to be processed * by a computation that can be blocking, then one may * use <code>exec</code> to redirect this computation into an * appropriate queue.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-delay"><a href="#val-delay" class="anchor"></a><code><span><span class="keyword">val</span> delay : <span>priority:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-handler">handler</a></span> <span class="arrow">&#45;&gt;</span></span> <span>float <span class="arrow">&#45;&gt;</span></span> <span><span>(unit, <span class="type-var">'b</span>)</span> <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>delay ~priority h d</code> creates a computation that returns * <code>unit</code> after delay <code>d</code> in seconds.</p></div></div><h3 id="read/write"><a href="#read/write" class="anchor"></a>Read/write</h3><div class="odoc-spec"><div class="spec value anchored" id="val-read"><a href="#val-read" class="anchor"></a><code><span><span class="keyword">val</span> read : 
  <span>?timeout:float <span class="arrow">&#45;&gt;</span></span>
  <span>priority:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span>marker:<a href="argument-1-Io/index.html#type-marker">Io.marker</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-handler">handler</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string, <span class="type-var">'b</span>)</span> <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>read ?timeout ~priority ~marker h</code> creates a * computation that reads from <code>h.socket</code> * and returns the first string split * according to <code>marker</code>. This function * can be used to create a computation that * reads data from a socket. <code>timeout</code> parameter * forces the computation to return an error if * nothing has been read for more than <code>timeout</code> * seconds. Default: wait forever.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-read_all"><a href="#val-read_all" class="anchor"></a><code><span><span class="keyword">val</span> read_all : 
  <span>?timeout:float <span class="arrow">&#45;&gt;</span></span>
  <span>priority:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span class="type-var">'a</span> <a href="../../index.html#type-scheduler">scheduler</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="argument-1-Io/index.html#type-socket">Io.socket</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(string, string * <a href="argument-1-Io/index.html#type-failure">Io.failure</a>)</span> <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>read_all ?timeout ~priority s sock</code> creates a * computation that reads all data from <code>sock</code> * and returns it. Raised value contains data * read before an error occured.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write"><a href="#val-write" class="anchor"></a><code><span><span class="keyword">val</span> write : 
  <span>?timeout:float <span class="arrow">&#45;&gt;</span></span>
  <span>priority:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-handler">handler</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span>?offset:int <span class="arrow">&#45;&gt;</span></span>
  <span>?length:int <span class="arrow">&#45;&gt;</span></span>
  <span><span class="xref-unresolved">Stdlib</span>.Bytes.t <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span class="type-var">'b</span>)</span> <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>write ?timeout ~priority h s</code> creates a computation * that writes string <code>s</code> to <code>h.socket</code>. This * function can be used to create a computation * that sends data to a socket. <code>timeout</code> parameter * forces the computation to return an error if * nothing has been written for more than <code>timeout</code> * seconds. Default: wait forever.</p></div></div><div class="odoc-spec"><div class="spec value anchored" id="val-write_bigarray"><a href="#val-write_bigarray" class="anchor"></a><code><span><span class="keyword">val</span> write_bigarray : 
  <span>?timeout:float <span class="arrow">&#45;&gt;</span></span>
  <span>priority:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span>
  <span><span><span>(<span class="type-var">'a</span>, <span class="type-var">'b</span>)</span> <a href="#type-handler">handler</a></span> <span class="arrow">&#45;&gt;</span></span>
  <span><a href="argument-1-Io/index.html#type-bigarray">Io.bigarray</a> <span class="arrow">&#45;&gt;</span></span>
  <span><span>(unit, <span class="type-var">'b</span>)</span> <a href="../index.html#type-t">t</a></span></span></code></div><div class="spec-doc"><p><code>write_bigarray ?timeout ~priority h ba</code> creates a computation * that writes data from <code>ba</code> to <code>h.socket</code>. This function * can to create a computation that writes data to a socket.</p></div></div></div></body></html>